{"mappings":"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","sources":["src/startup.ts"],"sourcesContent":["import * as L from \"leaflet\";\nimport { createNostrAccount, getRelays, setRelays } from \"./nostr\";\nimport {\n  _createPrivateKey,\n  getPublicKey,\n  hasPrivateKey,\n  setPrivateKey,\n  getNpubPublicKey,\n  getNsecPrivateKey,\n} from \"./nostr/keys\";\nimport { getProfile, setProfile } from \"./nostr/profiles\";\nimport { getUrlFromNpubPublicKey } from \"./router\";\n\nexport const startup = async () => {\n  const isLoggedIn = await hasPrivateKey();\n\n  const loggedIn = L.DomUtil.get(\"loggedIn\")!;\n  const loggedOut = L.DomUtil.get(\"loggedOut\")!;\n\n  if (isLoggedIn) {\n    L.DomUtil.addClass(loggedIn, \"show\");\n    L.DomUtil.addClass(loggedOut, \"hide\");\n\n    const publicKey = await getPublicKey();\n    const npubPublicKey = await getNpubPublicKey();\n    const nsecPrivateKey = await getNsecPrivateKey();\n\n    const publicKeySpan = globalThis.document.getElementById(\"npubPublicKey\")!;\n    publicKeySpan.innerText = npubPublicKey;\n    const nsecPrivateKeySpan =\n      globalThis.document.getElementById(\"nsecPrivateKey\")!;\n    nsecPrivateKeySpan.innerText = nsecPrivateKey;\n\n    const yourUrl = getUrlFromNpubPublicKey({ npubPublicKey });\n    const yourUrlHref = globalThis.document.getElementById(\n      \"yourUrl\"\n    ) as HTMLLinkElement;\n    yourUrlHref.href = yourUrl;\n    yourUrlHref.innerText = yourUrl;\n\n    const profileNameInput = document.getElementById(\n      \"profile_name\"\n    ) as HTMLInputElement;\n    const profileAboutInput = document.getElementById(\n      \"profile_about\"\n    ) as HTMLInputElement;\n    const profile = await getProfile({ publicKey });\n    profileNameInput.value = profile.name;\n    profileAboutInput.value = profile.about;\n\n    const profileSubmitButton = document.getElementById(\"profile_submit\")!;\n    profileSubmitButton.onclick = async (event) => {\n      event.preventDefault();\n      profileSubmitButton.setAttribute(\"disabled\", \"disabled\");\n\n      const name = profileNameInput.value;\n      const about = profileAboutInput.value;\n\n      try {\n        await setProfile({ name, about });\n\n        globalThis.alert(\"Your profile was updated.\");\n        globalThis.document.location.reload();\n      } catch {\n        globalThis.alert(\"There was an error. Please try again.\");\n        profileSubmitButton.removeAttribute(\"disabled\");\n      }\n    };\n\n    const relaysInput = document.getElementById(\"relays\") as HTMLInputElement;\n    getRelays().then((relays) => {\n      const relaysJson = JSON.stringify(relays);\n      relaysInput.value = relaysJson;\n    });\n\n    const relaySubmitButton = document.getElementById(\"relays_submit\")!;\n    relaySubmitButton.onclick = async (event) => {\n      event.preventDefault();\n      relaySubmitButton.setAttribute(\"disabled\", \"disabled\");\n\n      const relaysJson = relaysInput.value;\n      try {\n        const relays = JSON.parse(relaysJson) as string[];\n        if (!Array.isArray(relays) || relays.length === 0) {\n          relaySubmitButton.removeAttribute(\"disabled\");\n          globalThis.alert(\"Invalid relays submitted. Please try again.\");\n          return;\n        }\n        await setRelays({ relays });\n        globalThis.alert(\"Relays saved.\");\n        globalThis.document.location.reload();\n      } catch (error) {\n        relaySubmitButton.removeAttribute(\"disabled\");\n        globalThis.alert(`#vRuf1N Error saving relays\\n${error.toString()}`);\n      }\n    };\n  } else {\n    L.DomUtil.addClass(loggedIn, \"hide\");\n    L.DomUtil.addClass(loggedOut, \"show\");\n\n    const signupSubmit = document.getElementById(\"signup_submit\")!;\n    signupSubmit.onclick = async (event) => {\n      event.preventDefault();\n      signupSubmit.setAttribute(\"disabled\", \"disabled\");\n      const name = (document.getElementById(\"signup_name\") as HTMLInputElement)\n        .value;\n      const about = (\n        document.getElementById(\"signup_about\") as HTMLInputElement\n      ).value;\n\n      try {\n        await createNostrAccount();\n        setProfile({ name, about }).then(() => {\n          globalThis.alert(\"Your account was created.\");\n          globalThis.document.location.reload();\n        });\n      } catch {\n        signinSubmit.removeAttribute(\"disabled\");\n      }\n    };\n\n    const signinSubmit = document.getElementById(\"signin_submit\")!;\n    signinSubmit.onclick = async (event) => {\n      event.preventDefault();\n      signupSubmit.setAttribute(\"disabled\", \"disabled\");\n      const privateKey = (\n        document.getElementById(\"signin_privateKey\") as HTMLInputElement\n      ).value;\n\n      try {\n        setPrivateKey({ privateKey });\n        globalThis.alert(\"You were signed in successfully.\");\n        globalThis.document.location.reload();\n      } catch {\n        signinSubmit.removeAttribute(\"disabled\");\n      }\n    };\n  }\n};\nstartup();\n"],"names":["$8JYDX","parcelRequire","async","isLoggedIn","$lsWS8","hasPrivateKey","loggedIn","DomUtil","get","loggedOut","addClass","publicKey","getPublicKey","npubPublicKey","getNpubPublicKey","nsecPrivateKey","getNsecPrivateKey","globalThis","document","getElementById","innerText","yourUrl","$a5GLL","getUrlFromNpubPublicKey","yourUrlHref","href","profileNameInput","profileAboutInput","profile","$8JDfT","getProfile","value","name","about","profileSubmitButton","onclick","event","preventDefault","setAttribute","setProfile","alert","location","reload","removeAttribute","relaysInput","$F1Hgz","getRelays","then","relays","relaysJson","JSON","stringify","relaySubmitButton","parse","Array","isArray","length","setRelays","error","toString","signupSubmit","createNostrAccount","signinSubmit","privateKey","setPrivateKey","$c68123b027adfc04$export$26a1f54597e2915b"],"version":3,"file":"index.3074eae9.js.map"}