{"mappings":"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","sources":["src/startup.ts"],"sourcesContent":["import * as L from \"leaflet\";\nimport { getRelays, setRelays } from \"./nostr\";\nimport {\n  createPrivateKey,\n  getPublicKey,\n  hasPrivateKey,\n  setPrivateKey,\n  getNpubPublicKey,\n  getNsecPrivateKey,\n} from \"./nostr/keys\";\nimport { getProfile, setProfile } from \"./nostr/profiles\";\nimport { createRelays } from \"./nostr/relays\";\nimport { getUrlFromNpubPublicKey } from \"./router\";\n\nexport const startup = async () => {\n  await createRelays();\n  const isLoggedIn = await hasPrivateKey();\n\n  const loggedIn = L.DomUtil.get(\"loggedIn\")!;\n  const loggedOut = L.DomUtil.get(\"loggedOut\")!;\n\n  if (isLoggedIn) {\n    L.DomUtil.addClass(loggedIn, \"show\");\n    L.DomUtil.addClass(loggedOut, \"hide\");\n\n    const publicKey = await getPublicKey();\n    const npubPublicKey = await getNpubPublicKey();\n    const nsecPrivateKey = await getNsecPrivateKey();\n\n    const publicKeySpan = globalThis.document.getElementById(\"npubPublicKey\")!;\n    publicKeySpan.innerText = npubPublicKey;\n    const nsecPrivateKeySpan =\n      globalThis.document.getElementById(\"nsecPrivateKey\")!;\n    nsecPrivateKeySpan.innerText = nsecPrivateKey;\n\n    const yourUrl = getUrlFromNpubPublicKey({ npubPublicKey });\n    const yourUrlHref = globalThis.document.getElementById(\n      \"yourUrl\"\n    ) as HTMLLinkElement;\n    yourUrlHref.href = yourUrl;\n    yourUrlHref.innerText = yourUrl;\n\n    const profileNameInput = document.getElementById(\n      \"profile_name\"\n    ) as HTMLInputElement;\n    const profileAboutInput = document.getElementById(\n      \"profile_about\"\n    ) as HTMLInputElement;\n    const profile = await getProfile({ publicKey });\n    profileNameInput.value = profile.name;\n    profileAboutInput.value = profile.about;\n\n    const profileSubmitButton = document.getElementById(\"profile_submit\")!;\n    profileSubmitButton.onclick = async (event) => {\n      event.preventDefault();\n      profileSubmitButton.setAttribute(\"disabled\", \"disabled\");\n\n      const name = profileNameInput.value;\n      const about = profileAboutInput.value;\n\n      try {\n        await setProfile({ name, about });\n\n        globalThis.alert(\"Your profile was updated.\");\n        globalThis.document.location.reload();\n      } catch {\n        globalThis.alert(\"There was an error. Please try again.\");\n        profileSubmitButton.removeAttribute(\"disabled\");\n      }\n    };\n  } else {\n    L.DomUtil.addClass(loggedIn, \"hide\");\n    L.DomUtil.addClass(loggedOut, \"show\");\n\n    const signupSubmit = document.getElementById(\"signup_submit\")!;\n    signupSubmit.onclick = async (event) => {\n      event.preventDefault();\n      signupSubmit.setAttribute(\"disabled\", \"disabled\");\n      const name = (document.getElementById(\"signup_name\") as HTMLInputElement)\n        .value;\n      const about = (\n        document.getElementById(\"signup_about\") as HTMLInputElement\n      ).value;\n\n      try {\n        await createPrivateKey();\n        setProfile({ name, about }).then(() => {\n          globalThis.alert(\"Your account was created.\");\n          globalThis.document.location.reload();\n        });\n      } catch {\n        signinSubmit.removeAttribute(\"disabled\");\n      }\n    };\n\n    const signinSubmit = document.getElementById(\"signin_submit\")!;\n    signinSubmit.onclick = async (event) => {\n      event.preventDefault();\n      signupSubmit.setAttribute(\"disabled\", \"disabled\");\n      const privateKey = (\n        document.getElementById(\"signin_privateKey\") as HTMLInputElement\n      ).value;\n\n      try {\n        setPrivateKey({ privateKey });\n        globalThis.alert(\"You were signed in successfully.\");\n        globalThis.document.location.reload();\n      } catch {\n        signinSubmit.removeAttribute(\"disabled\");\n      }\n    };\n  }\n\n  const relaysInput = document.getElementById(\"relays\") as HTMLInputElement;\n  const relays = await getRelays();\n  const relaysJson = JSON.stringify(relays);\n  relaysInput.value = relaysJson;\n\n  const relaySubmitButton = document.getElementById(\"relays_submit\")!;\n  relaySubmitButton.onclick = async (event) => {\n    event.preventDefault();\n    relaySubmitButton.setAttribute(\"disabled\", \"disabled\");\n\n    const relaysJson = relaysInput.value;\n    try {\n      const relays = JSON.parse(relaysJson) as string[];\n      if (!Array.isArray(relays) || relays.length === 0) {\n        relaySubmitButton.removeAttribute(\"disabled\");\n        globalThis.alert(\"Invalid relays submitted. Please try again.\");\n        return;\n      }\n      await setRelays({ relays });\n      globalThis.alert(\"Relays saved.\");\n      globalThis.document.location.reload();\n    } catch (error) {\n      relaySubmitButton.removeAttribute(\"disabled\");\n      globalThis.alert(`#vRuf1N Error saving relays\\n${error.toString()}`);\n    }\n  };\n};\nstartup();\n"],"names":["$8JYDX","parcelRequire","async","$jktzu","createRelays","isLoggedIn","$lsWS8","hasPrivateKey","loggedIn","DomUtil","get","loggedOut","addClass","publicKey","getPublicKey","npubPublicKey","getNpubPublicKey","nsecPrivateKey","getNsecPrivateKey","globalThis","document","getElementById","innerText","yourUrl","$a5GLL","getUrlFromNpubPublicKey","yourUrlHref","href","profileNameInput","profileAboutInput","profile","$8JDfT","getProfile","value","name","about","profileSubmitButton","onclick","event","preventDefault","setAttribute","setProfile","alert","location","reload","removeAttribute","signupSubmit","createPrivateKey","then","signinSubmit","privateKey","setPrivateKey","relaysInput","relays","$F1Hgz","getRelays","relaysJson","JSON","stringify","relaySubmitButton","parse","Array","isArray","length","setRelays","error","toString","$c68123b027adfc04$export$26a1f54597e2915b"],"version":3,"file":"index.b13e34e2.js.map"}